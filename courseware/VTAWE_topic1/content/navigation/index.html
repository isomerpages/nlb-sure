<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Navigate</title>
    <link rel="stylesheet" href="css/main.css"/>
    <script type="text/javascript" src="js/jquery-min.js"></script>
    <script type="text/javascript" src="js/raphael-min.js"></script>
    <script type="text/javascript" src="js/jquery.spritely.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <style>
        body,html{
            margin: 0px;
            padding:0px;
            width:100%;
            height:100%;
            overflow: hidden;
        }
    </style>
    <script type="text/javascript">
        
       
    //Adult topic 1
    var topic = [
                {category:"Identifying Elements of Visual-Rich Environment",title:"Communicating in the 21st Century",type:"video",path:"",icon:"a1.jpg",icon_d:"a1_d.jpg",x:"69",y:"70",link:"content/topics/adult/1/1.html"},
                {category:"Identifying Elements of Visual-Rich Environment",title:"Speed and Engagement Levels",type:"video",path:"",icon:"a2.jpg",icon_d:"a2_d.jpg",x:"390",y:"426",link:"content/topics/adult/1/2.html"},
                {category:"Identifying Elements of Visual-Rich Environment",title:"Perceptions and Reactions",type:"activity",path:"",icon:"a3.jpg",icon_d:"a3_d.jpg",x:"690",y:"190",link:"content/topics/adult/1/3.html"},
                {category:"Identifying Elements of Visual-Rich Environment",title:"Creators and Audience",type:"video",path:"",icon:"a4.jpg",icon_d:"a4_d.jpg",x:"950",y:"440",link:"content/topics/adult/1/4.html"},
                {category:"Identifying Elements of Visual-Rich Environment",title:"Overt and Covert Messages",type:"video",path:"",icon:"a5.jpg",icon_d:"a5_d.jpg",x:"1150",y:"190",link:"content/topics/adult/1/5.html"}
            ];
        var paper;
        var paths=[];
        var currentSavePoint = null;
        var highlight;
        var thisPage=this;
        var avatar;
        var currentTargetIndex;
        var avatarPositionIndex;
        var firstStart;
        var tmpCookie;
        $(document).ready(function(){
            thisPage.parent.itemNumber = topic.length;
            
            //Add Title
            thisPage.parent.$("#brdcrumb").text(topic[0].category);
            
            firstStart=thisPage.parent.firstStart;
            if(firstStart){
                try{
                    tmpCookie = $.cookie("nlb_idx");
                    if(tmpCookie){
                        thisPage.parent.currentTargetIndex = thisPage.parent.avatarPositionIndex = tmpCookie;
                    }
                }
                catch(e){}
            }
            else{
                try{
                    $.removeCookie("nlb_idx");
                    $.cookie("nlb_idx", thisPage.parent.currentTargetIndex);
                }
                catch(e){}
            }
            currentTargetIndex=thisPage.parent.currentTargetIndex;
            avatarPositionIndex = thisPage.parent.avatarPositionIndex;
            if(currentTargetIndex>=topic.length)currentTargetIndex=topic.length-1;
            if(avatarPositionIndex>=topic.length)avatarPositionIndex=topic.length-1;
            
            
            highlight = $("<img class='save-highlight' src='images/glow.png'/>");
            $("#nav-cover").append(highlight);
            highlight.hide();//Add for testing;
            var div;
            var txt;
            for(var i=0;i<topic.length;i++){
                div = $("<img class='save-points' src='images/"+topic[i].icon_d+"'/>");
                div.data("icon",topic[i].icon);
                div.data("link",topic[i].link);
                div.data("icon_d",topic[i].icon_d);
                div.data("type",topic[i].type);
                div.data("id",i);
                $("#nav-cover").append(div);
                
                txt = $("<div class='title-text'>"+topic[i].title+"</div>");
                $("#nav-cover").append(txt);
            }
            
            _h = $("#nav-wrapper").height();
            _w = $("#nav-wrapper").width();
            
            widthRatio = _h/origH;
            heightRatio = _h/origH;
            
            
            avatar = $("<div class='avatar-ico'></div>");
            $("#nav-cover").append(avatar);
            //avatar.sprite({fps:12, no_of_frames: 8});
            avatar.hide();//Add for testing
            resizeContainer();
            resizeSavePoints();
            
            setSavePointPosition();
            
            /**Add for testing*/
            for(var i=0;i<topic.length;i++){
                savepoint = $($(".save-points")[i]);
                savepoint.css({
                    cursor:"pointer"
                });
                savepoint.click(function(){
                    runContent($(this));  
                });
            }
            
            //======================
            
            /*Disable for testing
            for(var i=0;i<currentTargetIndex;i++){
                savepoint = $($(".save-points")[i]);
                savepoint.css({
                    cursor:"pointer"
                });
                savepoint.click(function(){
                    runContent($(this));  
                });
            }*/
                
            if(firstStart){
                thisPage.parent.firstStart=false;
                
                var savepoint = $($(".save-points")[currentTargetIndex]);
                
                savepoint.css({
                    cursor:"pointer"
                });
                savepoint.click(function(){
                    runInitialContent($(this));  
                }); 
            }
            else{
                var savepoint = $($(".save-points")[currentTargetIndex]);
                
                savepoint.css({
                    cursor:"pointer"
                });
                savepoint.click(function(){
                    runContent($(this));  
                });
            }
        });
        
        function runContent(savepoint){
            avatar.destroy();
            avatar.sprite({fps:12, no_of_frames: 8});
            
            thisPage.parent.$("#brdcrumb").text(topic[savepoint.data("id")].category+" >> "+topic[savepoint.data("id")].title);
            
            //Add this this temporarily for testing
            thisPage.parent.control.addLoadingPage();
            thisPage.parent.$("#pageHolder").attr("src",savepoint.data("link")+"?type="+savepoint.data("type"));
            return;
            //=================================
            if(savepoint.data("id")<=avatarPositionIndex){
                thisPage.parent.control.addLoadingPage();
                thisPage.parent.$("#pageHolder").attr("src",savepoint.data("link")+"?type="+savepoint.data("type"));
                return;
                //if(savepoint.data("type")=="video"){
                //    thisPage.parent.control.addControl();
                //}
            }
            thisPage.parent.avatarPositionIndex = savepoint.data("id");
            setTimeout(function(){
                avatar.stop().animate({
                    top:savepoint.position().top + (savepoint.height()-avatar.height())/2,
                    left:savepoint.position().left +(savepoint.width()-avatar.width())/2
                },3000,function(){
                    avatar.destroy();
                    thisPage.parent.control.addLoadingPage();
                    thisPage.parent.$("#pageHolder").attr("src",savepoint.data("link")+"?type="+savepoint.data("type"));

                    //if(savepoint.data("type")=="video"){
                    //    thisPage.parent.control.addControl();
                    //}
                });
            },300);
        }
        
        function setSavePointPosition(){
            setHightLight(currentTargetIndex);
            setAvatar(avatarPositionIndex);
        }
        
        function setAvatar(idx){
            var savepoint = $($(".save-points")[idx]);
            avatar.css({
                top:-20+savepoint.position().top + (savepoint.height()-avatar.height())/2,
                left:savepoint.position().left +(savepoint.width()-avatar.width())/2
            });
            
            $(".save-points").css({
                border:"5px solid orange"//change from gray to orange for testing
            });
            savepoint.css({
                border:"5px solid orange"
            });
            
            
            
            for(var i=0;i<topic.length;i++){
                if(currentTargetIndex<=i){
                    $($(".save-points")[i]).attr("src","images/"+$($(".save-points")[i]).data("icon_d"));//disable for testing
                    $($(".save-points")[i]).attr("src","images/"+$($(".save-points")[i]).data("icon"));//add for testing
                }
                else $($(".save-points")[i]).attr("src","images/"+$($(".save-points")[i]).data("icon"));
            }
            
            savepoint.attr("src","images/"+savepoint.data("icon"));
        }
        
        function setHightLight(idx){
            var savepoint = $($(".save-points")[idx]);
            highlight.css({
                top:2.5+savepoint.position().top + (savepoint.height()-highlight.height())/2,
                left:2.5+savepoint.position().left +(savepoint.width()-highlight.width())/2
            });
        }
        function runInitialContent(savepoint){
            thisPage.parent.$("#brdcrumb").text(topic[savepoint.data("id")].category+" >> "+topic[savepoint.data("id")].title);
            
            
            thisPage.parent.control.addLoadingPage();
            thisPage.parent.$("#pageHolder").attr("src",savepoint.data("link")+"?type="+savepoint.data("type"));
            
            //if(savePoint.data("type")=="video"){
            //    thisPage.parent.control.addControl();
            //}
        }
        
        function resizeSavePoints(){
            paper.clear();
            for(var i=0;i<$(".save-points").length;i++){
                $($(".save-points")[i]).css({
                    width:iconW*widthRatio,
                    height:iconH*heightRatio,
                    left:topic[i].x*widthRatio,
                    top:topic[i].y*heightRatio,
                    border:"5px solid orange"//gray from gray to orange for testing
                });
                
                if(i>0){
                    //alert("M"+($($(".save-points")[i-1]).position().left+$($(".save-points")[i-1]).width()/2)+","+($($(".save-points")[i-1]).position().top+$($(".save-points")[i-1]).height()/2)+"L"+($($(".save-points")[i]).position().left+$($(".save-points")[i]).width()/2)+","+($($(".save-points")[i]).position().top+$($(".save-points")[i]).height()/2))
                    paper.path("M"+($($(".save-points")[i-1]).position().left+$($(".save-points")[i-1]).width()/2)+","+($($(".save-points")[i-1]).position().top+$($(".save-points")[i-1]).height()/2)+"L"+($($(".save-points")[i]).position().left+$($(".save-points")[i]).width()/2)+","+($($(".save-points")[i]).position().top+$($(".save-points")[i]).height()/2)).attr({"stroke":"#00FFFF","stroke-width":10,"stroke-dasharray":"-"});
                    
                }
               // alert($($(".save-points")[i]).position().top)
                $($(".title-text")[i]).css({
                    width:$($(".save-points")[i]).width()+40,
                    minHeight:$($(".save-points")[i]).height()*.25,
                    left:$($(".save-points")[i]).position().left-20+2.5,
                    top:$($(".save-points")[i]).position().top + $($(".save-points")[i]).height()-20
                });
            }
            
            highlight.css({
                width:highW*widthRatio,
                height:highH*heightRatio
            });
            
            avatar.css({
                transform:"scale("+(widthRatio*.6)+")"
            });
            
            var savepoint = $($(".save-points")[avatarPositionIndex]);
            avatar.css({
                top:-20+savepoint.position().top + (savepoint.height()-avatar.height())/2,
                left:savepoint.position().left +(savepoint.width()-avatar.width())/2
            });
           //targetSavePoint($($(".save-points")[currentTargetIndex]));
        }
        
        //SET the highlight to the selected one.
        function targetSavePoint(savePoint,select){
            
            if(!select){
                avatar.css({
                    top:savePoint.position().top + (savePoint.height()-avatar.height())/2,
                    left:savePoint.position().left +(savePoint.width()-avatar.width())/2
                });
            }
            else{
                avatar.destroy();
                avatar.sprite({fps:12, no_of_frames: 8});
                setTimeout(function(){
                    avatar.stop().animate({
                        top:savePoint.position().top + (savePoint.height()-avatar.height())/2,
                        left:savePoint.position().left +(savePoint.width()-avatar.width())/2
                    },3000,function(){
                        avatar.destroy();
                    });
                },300);
                
            }
            
        }
        
        function resizeContainer(){
            var ratio = origH/_h;
            
            $("#nav-menu").css({
                height:_h,
                width:_h*origW/origH
            });
            if(paper)paper.remove();
            paper = Raphael("nav-menu",$("#nav-menu").width(),$("#nav-menu").height());
        }
        
        var _h=768;
        var _w=1024;
        var origW=3000;
        var origH=720;
        var iconW = 100;
        var iconH = 100;
        var highH = 150;
        var highW = 150;
        var widthRatio=1;
        var heightRatio=1;
        var avatarW=80;
        var avatarH=190;
        window.onresize=function(){
            _h = $("#nav-wrapper").height();
            _w = $("#nav-wrapper").width();
            widthRatio = _h/origH;
            heightRatio = _h/origH;
            resizeContainer();
            resizeSavePoints();
            
        };
    </script>
</head>
<body>
    <div id="nav-wrapper">
        <div id="nav-menu">
            <div id="nav-cover"></div>
        </div>
    </div>
</body>
</html>